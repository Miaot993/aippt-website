---
/**
 * @component ThemeToggle (暗黑/浅色模式切换)
 * @description 视觉模式的物理开关。允许用户在 Light 和 Dark 模式间自由切换，并记住用户的偏好。
 * @tips 我们已经在此去除了默认的蓝色 Focus 轮廓线（Tailwind Ring），以保证与黑金主题的绝对融合。修改 SVG 图标时请注意保持宽高比一致。
 */

// src/components/ThemeToggle.astro
// 这个组件只负责一件事：切换白天/黑夜模式
---

<theme-toggle>
  <button
    id="theme-toggle"
    type="button"
    class="relative flex items-center justify-center w-9 h-9 rounded-full text-zinc-500 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800 transition-colors focus:outline-none"
    aria-label="Toggle Dark Mode"
  >
    <svg
      class="w-5 h-5 hidden dark:block text-amber-400"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
      ></path>
    </svg>

    <svg
      class="w-5 h-5 block dark:hidden text-indigo-600"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
      ></path>
    </svg>
  </button>
</theme-toggle>

<script>
  // 定义 Web Component，确保逻辑封装
  class ThemeToggle extends HTMLElement {
    constructor() {
      super();
      const button = this.querySelector("button");

      if (!button) return;

      // 绑定点击事件
      button.addEventListener("click", () => {
        const root = document.documentElement;
        
        // 1. 获取当前状态
        // 逻辑：如果 html 标签上有 data-theme='dark'，或者类名里有 'dark'
        const currentTheme = root.getAttribute("data-theme");
        const isDark = currentTheme === "dark";

        // 2. 计算下一个状态
        const nextTheme = isDark ? "light" : "dark";

        // 3. 执行切换 (双管齐下)
        // A. 告诉 Starlight (通过 data-theme)
        root.setAttribute("data-theme", nextTheme);

        // B. 告诉 Tailwind (通过 class)
        if (nextTheme === "dark") {
          root.classList.add("dark");
        } else {
          root.classList.remove("dark");
        }

        // 4. 持久化存储
        localStorage.setItem("starlight-theme", nextTheme);
      });
    }
  }

  // 注册组件
  customElements.define("theme-toggle", ThemeToggle);
</script>