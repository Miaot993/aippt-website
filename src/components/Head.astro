---
/**
 * @component Head (全局 HTML 头部)
 * @description 全局元数据控制台。用于覆盖或扩展框架的 `<head>` 标签。在这里注入 Google Analytics (GA4) 统计代码、自定义字体、以及给社交媒体分享用的 OpenGraph (OG) 协议标签。
 * @tips 添加第三方脚本时，注意使用 `defer` 或 `async` 属性，避免阻塞页面首屏渲染。
 */

import type { Props } from "@astrojs/starlight/props";
import Default from "@astrojs/starlight/components/Head.astro";

const ogTitle = Astro.props.entry?.data?.title || Astro.props.siteTitle;
---

<Default {...Astro.props}><slot /></Default>

<meta property="og:site_name" content="AI&PPT 第二大脑" />
<meta property="og:type" content="article" />
<meta property="og:title" content={ogTitle} />
<meta name="twitter:card" content="summary_large_image" />

<script is:inline>
  // 定义同步逻辑：把 data-theme 的状态同步给 class="dark"
  function syncTheme() {
    const root = document.documentElement;
    const theme = root.getAttribute('data-theme');
    
    // 如果 Starlight 说是暗色，或者系统偏好是暗色且没设置过
    const isDark = theme === 'dark' || 
      (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches);

    if (isDark) {
      root.classList.add('dark');
    } else {
      root.classList.remove('dark');
    }
  }

  // A. 页面刚加载时，立即跑一次
  syncTheme();

  // B. 监听页面变化 (防止 Astro 视图过渡导致失效)
  document.addEventListener('astro:after-swap', syncTheme);

  // C. 【核武器】创建一个观察者，死死盯着 html 标签
  // 只要 data-theme 属性一变，马上触发 syncTheme
  const observer = new MutationObserver(syncTheme);
  observer.observe(document.documentElement, { 
    attributes: true, 
    attributeFilter: ['data-theme'] 
  });
</script>

<script is:inline>
  (function () {
    try {
      const role = localStorage.getItem("user_role");
      if (role === "pro") {
        document.documentElement.setAttribute("data-user-role", "pro");
      }
    } catch (e) {}
  })();
</script>