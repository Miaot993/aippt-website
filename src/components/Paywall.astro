---
/**
 * @component Paywall (付费墙 / 权限验证网关)
 * @description 商业变现的核心防御工事。当检测到当前文章包含受限内容且用户未提供有效的 Access Key 时，展示此组件。负责引导用户了解 Pro 权益并前往购买。
 * @tips 这里的文案和按钮设计直接影响转化率！保持“黑金”视觉的压迫感与高级感，按钮一定要极其醒目。
 */

// src/components/Paywall.astro
---

{/* 🛡️ 核心大招：CSS 绝对防御力场 */}
<style is:inline id="paywall-css-lock">
  /* 1. 保留文章前2个元素(标题和导语)，从第6个元素起全部强制高斯模糊！ */
  .sl-markdown-content > *:nth-child(n+6):not(#pro-paywall):not(style):not(script) {
      filter: blur(4px) !important;
      opacity: 0.15 !important;
      pointer-events: none !important;
      user-select: none !important;
      transition: all 0.3s ease;
  }
  /* 2. 直接隐藏掉过长的内容，防止用户一直往下滚 */
  .sl-markdown-content > *:nth-child(n+7):not(#pro-paywall):not(style):not(script) {
      display: none !important;
  }
  /* 3. 把拦截卡片往上提，正好盖在被模糊的内容上方 */
  #pro-paywall {
      margin-top: 0px !important; 
      position: relative;
      z-index: 999;
      padding-bottom: 2rem;
  }
</style>

<div id="pro-paywall" class="w-full clear-both flex justify-center">
  <div class="relative z-50 w-full max-w-md mx-auto">
    {/*
        👇 修改 1：卡片容器增强
        在原来的 class 基础上，增加了 'flex flex-col items-center'
        这能确保里面的图标、标题、文字、按钮全部强制水平居中对齐。
    */}
    <div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-8 shadow-2xl shadow-indigo-500/20 flex flex-col items-center text-center transform hover:scale-[1.02] transition-transform">

      {/* 图标容器：这里的 mx-auto 现在有了双重保险 */}
      <div class="w-12 h-12 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
      </div>

      <h3 class="text-xl font-bold text-zinc-900 dark:text-white mb-2">解锁 Pro 权限</h3>
      
      {/* 👇 核心修复：删掉了失效的 Tailwind 类名，直接动用 style="margin-bottom: 40px;" 
          这里的 40px 你可以随意修改，数字越大，间距越大！绝对生效！
      */}
      <p 
        class="text-sm text-zinc-500 dark:text-zinc-400 leading-relaxed" 
        style="margin-bottom: 40px;"
      >
        您正在使用 Lite 体验版。<br/>升级 Pro，立即解锁全站核心工作流、商业源文件<br/>以及后续永久更新。
      </p>
      
      <a href="/#pricing" class="block w-full py-3.5 px-4 bg-zinc-900 dark:bg-white !text-white dark:!text-zinc-900 !no-underline rounded-xl font-bold transition-colors shadow-lg">
        立即获取 Access Key
      </a>

    </div>
  </div>
</div>

<script is:inline>
  (function() {
    // 💡 只有 Pro 用户登录了，JS 才会出面把 CSS 防御网拆除
    const checkPro = () => {
      const userRole = localStorage.getItem('user_role');
      if (userRole === 'pro') {
        const wall = document.getElementById('pro-paywall');
        if (wall) wall.remove();
        const lock = document.getElementById('paywall-css-lock');
        if (lock) lock.remove();
      }
    };
    
    checkPro();
    document.addEventListener('astro:page-load', checkPro);
  })();
</script>